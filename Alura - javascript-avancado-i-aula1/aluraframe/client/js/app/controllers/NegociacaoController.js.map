{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","Bind","DateHelper","NegociacaoDAO","NegociacaoService","MensagemView","NegociacoesView","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","_mensagem","_service","_init","lista","then","negociacoes","forEach","negociacao","adiciona","catch","erro","texto","setInterval","importaNegociacoes","data","textoParaDate","value","quantidade","valor","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","apaga","esvazia","ordena","coluna","inverteOrdem","a","b","importa","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\r\nimport {Mensagem} from '../models/Mensagem';\r\nimport {Negociacao} from '../models/Negociacao';\r\nimport {Bind} from '../helpers/Bind';\r\nimport {DateHelper} from '../helpers/DateHelper';\r\nimport {NegociacaoDAO} from '../DAO/NegociacaoDAO';\r\nimport {NegociacaoService} from '../services/NegociacaoService';\r\nimport {MensagemView} from '../views/MensagemView';\r\nimport {NegociacoesView} from '../views/NegociacoesView';\r\n\r\nclass NegociacaoController{\r\n\r\n    constructor(){\r\n        let $ = document.querySelector.bind(document);\r\n        this._inputData = $('#data');\r\n        this._inputQuantidade = $('#quantidade');\r\n        this._inputValor = $('#valor');\r\n        this._ordemAtual = '';\r\n\r\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(),\r\n                                         new NegociacoesView($('#negociacoesView')),\r\n                                         'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\r\n\r\n        this._mensagem = new Bind(new Mensagem(),\r\n                                    new MensagemView($('.mensagemView')),\r\n                                    'texto');\r\n\r\n        this._service = new NegociacaoService();\r\n        \r\n        this._init();\r\n    }\r\n\r\n    _init() {\r\n\r\n        this._service\r\n            .lista()\r\n            .then( negociacoes =>\r\n                negociacoes.forEach(negociacao =>\r\n                    this._listaNegociacoes.adiciona(negociacao)))\r\n            .catch(erro => this._mensagem.texto = erro);\r\n\r\n        setInterval(() => {\r\n            this.importaNegociacoes();\r\n        }, 3000);\r\n    }\r\n\r\n    get data(){\r\n        return DateHelper.textoParaDate(this._inputData.value);\r\n    }\r\n\r\n    get quantidade(){\r\n        return this._inputQuantidade.value;\r\n    }\r\n\r\n    get valor(){\r\n        return this._inputValor.value;\r\n    }\r\n\r\n    adiciona(event){\r\n        event.preventDefault();\r\n\r\n        let negociacao = this._criaNegociacao();\r\n\r\n        this._service\r\n            .cadastra(negociacao)\r\n            .then(mensagem => {\r\n                this._listaNegociacoes.adiciona(negociacao);\r\n                this._mensagem.texto = mensagem;\r\n                this._limpaFormulario();\r\n            })\r\n            .catch (erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    apaga(){\r\n\r\n        this._service\r\n            .apaga()\r\n            .then(mensagem => {\r\n                this._listaNegociacoes.esvazia();\r\n                this._mensagem.texto = mensagem;\r\n                })\r\n            .catch (erro => this._mensagem.texto = erro);\r\n        \r\n    }\r\n\r\n    ordena(coluna) {\r\n        if(this._ordemAtual == coluna) {\r\n            this._listaNegociacoes.inverteOrdem();\r\n        } else {\r\n            this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);    \r\n        }\r\n        this._ordemAtual = coluna;\r\n    }\r\n\r\n    importaNegociacoes(){\r\n\r\n        this._service\r\n            .importa(this._listaNegociacoes.negociacoes)\r\n            .then(negociacoes => negociacoes.forEach(negociacao =>{\r\n                this._listaNegociacoes.adiciona(negociacao);\r\n                this._mensagem.texto = 'Negocições do períodp importadas';\r\n            }))\r\n            .catch(erro => this.mensagem.texto = erro);\r\n    }\r\n\r\n    _criaNegociacao(){\r\n\r\n        return new Negociacao(\r\n                this.data,\r\n                parseInt(this.quantidade),\r\n                parseFloat(this.valor),\r\n        );\r\n    }\r\n\r\n    _limpaFormulario(){\r\n\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n\r\n        this._inputData.focus();\r\n    }\r\n}"]}